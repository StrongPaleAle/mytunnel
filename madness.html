<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<title>my tunnel of lo(l/n)eliness</title>
		<style>
			html, body {
				height: 100%;
			}

			body {
				background: #000000; /* Old browsers */
				background: -moz-radial-gradient(center, ellipse cover, #000000 0%, #242d42 100%); /* FF3.6-15 */
				background: -webkit-radial-gradient(center, ellipse cover, #000000 0%,#242d42 100%); /* Chrome10-25,Safari5.1-6 */
				background: radial-gradient(ellipse at center, #000000 0%,#242d42 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
				filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#000000', endColorstr='#242d42',GradientType=1 ); /* IE6-9 fallback on horizontal gradient */

				margin: 0;
				font-family: Arial;
				overflow: hidden;
			}

						
			img{
				-webkit-backface-visibility: visible; /* Chrome, Safari, Opera */
   	backface-visibility: visible;
   	min-width: 500px;
			}
		</style>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
		<script type="text/javascript">
                        
             $(function() {

	            $('body').on('click', '#container>div', function () {
	            	console.log("yep")
		        	// $(this).hide();
		
		            var docElm = document.documentElement;
		
		            // go full-screen
		            if (docElm.requestFullscreen) {
		                docElm.requestFullscreen();
		            } else if (docElm.webkitRequestFullscreen) {
		                docElm.webkitRequestFullscreen();
		            } else if (docElm.mozRequestFullScreen) {
		                docElm.mozRequestFullScreen();
		            } else if (docElm.msRequestFullscreen) {
		                docElm.msRequestFullscreen();
		            }
		            
		         
	
	        	});
	            
	            
	            
            });
			var randInterval = 0;
            var songList = ["song1","song2","song3"];
            var myAudio = new Audio("music/" + songList[Math.floor(Math.random()*songList.length)] + ".mp3");

            //Generates a random song, sets it attributes/properties, and 
            //appends a file extension that works with the browser.
            function getRandomSong(){
                var randSong = songList[Math.floor(Math.random()*songList.length)]
                if (myAudio.canPlayType('audio/mp3;')) {
                    myAudio.src="music/" + randSong + ".mp3";
                } else {
                    myAudio.src="music/" + randSong + ".ogg";
                }
                myAudio.id="myAudio";
                myAudio.volume=0.15;
                myAudio.load();
                myAudio.controls=false
                myAudio.preload=false;
            }

            //Sets a random interval for the setTimeout Function with the
            //'variation' parameter being a random amount of time in 
            //seconds, and the 'range' parameter being a set amount of time 
            //in seconds.
            function getRandomInterval(variation, range){
                randInterval = Math.floor((Math.random()*1000*variation)+(1000*range)); 
                return randInterval;
            }   
            
                       

            //Gets a random song and plays that song.
            function playMusic(){
                getRandomSong();
                myAudio.play();
            }

        </script>
	</head>
	<body>
		
		<script type="text/javascript">
            //Plays music on page load.
            $('body').on('click', '#container>div', function () {

            playMusic();

            //Event Listener that will start a new song after a pause
            //of randomly determined length.
            myAudio.addEventListener('ended', function(){setTimeout(function(){playMusic();}, getRandomInterval(2,2));}, false);
            });
        </script>

		<script src="js/three.min.js"></script>
		<script src="js/tween.min.js"></script>
		<script src="js/CSS3DRenderer.js"></script>
		<script src="js/controls/DeviceOrientationControls.js"></script>

		<div id="container"></div>
		

		<script>
			var camera, scene, renderer;
			var objects = [], player;

			var auto = true;
			//var controls;
			
			init();
			animate();
			
			
			
			
			function init() {

				camera = new THREE.PerspectiveCamera( 120, window.innerWidth / window.innerHeight, 0.001, 10000 );
				camera.position.y = 0;
				camera.position.z = -5000;
				
				scene = new THREE.Scene();

				renderer = new THREE.CSS3DRenderer();
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.domElement.style.position = 'absolute';
				renderer.domElement.style.top = 0;
				//controls = new THREE.DeviceOrientationControls( camera );
				document.getElementById( 'container' ).appendChild( renderer.domElement );

				//

				//controls = new THREE.DeviceOrientationControls( camera );
				
				

				document.body.addEventListener( 'mousewheel', onMouseWheel, false );

				

				document.body.addEventListener( 'click', function ( event ) {

					auto = true;

					if ( player !== undefined ) {

						player.parentNode.removeChild( player );
						player = undefined;

					}

					new TWEEN.Tween( camera.position )
							.to( { x: 0, y: 0 }, -50 )
							.easing( TWEEN.Easing.Exponential.Out )
							.start();

				}, false );

				window.addEventListener( 'resize', onWindowResize, false );
				
				
			}

			
			
			
function loadPosts () {
	var offset = 0;
    var api_key = "LyLuf1EPap7Z3SUIiaTnyc9sgU3HxHMuqUR1cyU2vkFZT3m8zg";
    var key = "api_key=" + api_key;
    var api = "http://api.tumblr.com/v2/blog/cronofagiacontemporanea.tumblr.com/";
    var retrieve_more = function (offset) {
        $.ajax({
	        
	        url:api + "posts/photo?limit=20&offset=" + offset + "&" + key,
	        dataType: 'jsonp',
	        success:function(data) {
	            console.log(data);
	            //$.each(data.response.posts, function(i, item) {
					
					var entries = data.response.posts;
					console.log(entries);
	
					console.log("load");
					// console.log( entries );
	
					for ( var e = 0; e <= 19; e ++ ) {
					//for ( var i = 1; i < 20; i ++ ) {
						  var p = entries[e];
						//var entry = entries[ i ];
	
						var element = document.createElement( 'div' );
						element.style.width = '400px';
						element.style.height = 'auto';
	
						var image = document.createElement( 'img' );
						image.addEventListener( 'load', function ( event ) {
	
							var object = this.properties.object;
							
							new TWEEN.Tween( object.position )
								.to( { y: Math.random() * 4000 - 2000 }, 4000 )
								.easing( TWEEN.Easing.Exponential.Out )
								.start();
	
						}, false );
						
						
						image.style.position = 'absolute';
						
						var altsize = p.photos[0].alt_sizes[2];
						
						if (altsize) {
							image.src =  p.photos[0].alt_sizes[2].url;
						} else {
							image.src =  p.photos[0].original_size.url;
						}
						
						
						
						if(!image.src){
							console.log(p)
						}
						element.appendChild( image );
	
						
	
						var blocker = document.createElement( 'div' );
						blocker.style.position = 'absolute';
						blocker.style.width = '400px';
						blocker.style.height = 'auto';
						
						blocker.style.cursor = 'pointer';
						element.appendChild( blocker );
	
						var object = new THREE.CSS3DObject( element );
						object.position.x = Math.random() * 4000 - 2000;
						object.position.y = Math.random() * 4000 - 2000;
						
						object.position.z = Math.random() * - 10000;
						scene.add( object );
	
						objects.push( object );
	
						//
	
						var properties = { data: p, blocker: blocker, object: object }
	
						element.properties = properties;
						image.properties = properties;
						}
	
	            //});
	
	            if (data.response.posts.length == 20) {
		            offset += 20;
	                retrieve_more(offset);
	            }
	            
	        }
	    });
    }

    retrieve_more(offset);
}

loadPosts();

			function move( delta ) {

				for ( var i = 0; i < objects.length; i ++ ) {

					var object = objects[ i ];

					object.position.z += delta;

					if ( object.position.z > - 5000 ) {

						object.position.z -= 10000;

					} else if ( object.position.z < - 20000 ) {

						$(object).remove()

					}

				}

			}

			function onMouseWheel( event ) {

				move( event.wheelDelta );

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function animate() {

				requestAnimationFrame( animate );

				TWEEN.update();

				if ( auto === true ) {

					move( 50 );
					
					

				}
				
				//controls.update();
				
				renderer.render( scene, camera );

			}

		</script>
	</body>
</html>
